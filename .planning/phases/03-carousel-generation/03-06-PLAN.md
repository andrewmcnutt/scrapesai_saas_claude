---
phase: 03-carousel-generation
plan: 06
type: execute
wave: 4
depends_on: ["03-01", "03-03"]
files_modified:
  - src/app/(dashboard)/layout.tsx
  - src/app/(dashboard)/generate/page.tsx
  - src/app/(dashboard)/dashboard/page.tsx
autonomous: true
requirements: [GEN-14, N8N-07, N8N-08, N8N-09, N8N-10]

must_haves:
  truths:
    - "Sidebar navigation includes links to Generate and History pages"
    - "Dashboard page has a Generate Carousel CTA"
    - "Timeout refund function exists in database (created in Plan 01)"
    - "N8N external concerns are documented and accounted for"
  artifacts:
    - path: "src/app/(dashboard)/layout.tsx"
      provides: "Updated sidebar with Generate and History nav links"
      contains: "generate"
    - path: "src/app/(dashboard)/dashboard/page.tsx"
      provides: "Dashboard with generation CTA"
      contains: "generate"
  key_links:
    - from: "src/app/(dashboard)/layout.tsx"
      to: "/generate"
      via: "Sidebar navigation link"
      pattern: "href.*generate"
    - from: "src/app/(dashboard)/layout.tsx"
      to: "/history"
      via: "Sidebar navigation link"
      pattern: "href.*history"
---

<objective>
Update dashboard navigation to include Generate and History links, add generation CTA to dashboard, and document N8N external requirements that live outside the Next.js codebase.

Purpose: The sidebar needs Generate and History navigation for users to access the new features. The dashboard should prominently surface the generation CTA. N8N requirements (retry logic, reconciliation, workflow editing) are handled outside the codebase but need to be documented for completeness.

Output: Updated sidebar navigation, dashboard CTA, and documentation of external N8N requirements.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/03-carousel-generation/03-CONTEXT.md
@.planning/phases/03-carousel-generation/03-03-SUMMARY.md

@src/app/(dashboard)/layout.tsx
@src/app/(dashboard)/dashboard/page.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Update sidebar navigation and dashboard page</name>
  <files>
    src/app/(dashboard)/layout.tsx
    src/app/(dashboard)/dashboard/page.tsx
  </files>
  <action>
1. Update `src/app/(dashboard)/layout.tsx` sidebar navigation to add new links:

Add to the `<nav>` section (after existing Dashboard and Brand Settings links):

- **Generate** link: href="/generate", icon: a sparkle/magic-wand or plus-circle SVG icon. Text: "Generate". Same styling as existing nav items.
- **History** link: href="/history", icon: a clock or list SVG icon. Text: "History". Same styling as existing nav items.

Organize nav items in logical order:
1. Dashboard (existing)
2. Generate (new)
3. History (new)
4. Brand Settings (existing)

Keep existing nav styling pattern (flex items-center, px-4 py-3, text-sm font-medium, hover:bg-gray-100, rounded-lg).

2. Update `src/app/(dashboard)/dashboard/page.tsx`:

Add a prominent "Generate Carousel" CTA section to the dashboard. This should be the primary action on the page.

**CTA section:**
- Card with blue/indigo gradient or accent color background
- Heading: "Create a New Carousel"
- Subtext: "Turn your ideas into professional LinkedIn carousels in minutes"
- Large "Generate Carousel" button linking to `/generate`
- Place prominently at top of dashboard content, above credit balance

Keep existing content (credit balance display, brand completion prompt if applicable).

3. Handle N8N external requirements documentation:

The following requirements are satisfied by work OUTSIDE the Next.js codebase. Document in the SUMMARY for traceability:

- **N8N-07** (retry callback failures): N8N workflow should be configured to retry HTTP requests 3 times with 30-second delay on 5xx responses. This is N8N-side configuration, not Next.js code.
- **N8N-08** (daily reconciliation): Deferred to post-launch operations per 03-RESEARCH.md. Not implemented in v1.
- **N8N-09** (orphaned image alerts): Deferred to post-launch operations per 03-RESEARCH.md. Not implemented in v1.
- **N8N-10** (N8N-MCP repo): N8N workflow lives in separate repository. Referenced but not part of Next.js codebase.
- **GEN-14** (timeout refund): The `refund_timeout_jobs()` function was created in Plan 01's migration. It needs to be called periodically. For v1, document that this should be invoked via Supabase pg_cron or a scheduled Vercel cron job. The function itself is ready; scheduling is an operational task.

No code changes needed for these -- they are documented as external/operational concerns in the SUMMARY.
  </action>
  <verify>
- Sidebar shows 4 navigation items: Dashboard, Generate, History, Brand Settings
- Dashboard page has a "Generate Carousel" CTA with link to /generate
- `npx tsc --noEmit` passes
- Navigation links render correctly
  </verify>
  <done>
- Sidebar includes Generate and History links with appropriate icons
- Dashboard has prominent carousel generation CTA
- N8N external requirements documented for operational follow-up
- Timeout refund function ready (created in Plan 01), scheduling documented
  </done>
</task>

</tasks>

<verification>
1. Sidebar shows Generate and History links
2. Dashboard CTA links to /generate
3. TypeScript compilation passes
4. All N8N external requirements accounted for in SUMMARY
</verification>

<success_criteria>
- Users can navigate to Generate and History from sidebar
- Dashboard prominently features generation CTA
- GEN-14 timeout refund mechanism exists (function created, scheduling documented)
- N8N-07, N8N-08, N8N-09, N8N-10 requirements addressed (external/deferred/documented)
</success_criteria>

<output>
After completion, create `.planning/phases/03-carousel-generation/03-06-SUMMARY.md`
</output>
